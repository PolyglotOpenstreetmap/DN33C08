<!DOCTYPE html>
<html>
<head>
    <title>Pico Relay Control</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background-color: #f0f0f0; }
        h1 { color: #333; }
        .relay-row { display: flex; justify-content: space-around; margin-bottom: 20px; }
        .relay-control { background-color: white; border-radius: 8px; padding: 15px; margin: 0 10px; flex: 1; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        button { width: 80px; height: 80px; border: none; border-radius: 50%; font-size: 16px; margin: 10px 0; cursor: pointer; }
        button.on { background-color: #ff4136; color: white; }
        button.off { background-color: #aaaaaa; color: black; }
        input { width: 80%; margin: 5px 0; }
    </style>
</head>
<body>
    <h1>Raspberry Pi Pico Relay Control</h1>
    <div id="relayControls"></div>

    <script>
        function updateRelayStates() {
            fetch('/relay_states')
                .then(response => response.json())
                .then(data => {
                    for (let i = 1; i <= 8; i++) {
                        let relay = data[`relay${i}`];
                        let button = document.getElementById(`relay${i}Button`);
                        if (button) {
                            button.className = relay.state ? 'on' : 'off';
                            button.textContent = relay.state ? 'ON' : 'OFF';
                        }
                    }
                });
        }

        function createRelayControls() {
            fetch('/relay_states')
                .then(response => response.json())
                .then(data => {
                    let controlsHtml = '<div class="relay-row">';
                    for (let i = 1; i <= 8; i++) {
                        let relay = data[`relay${i}`];
                        controlsHtml += `
                            <div class="relay-control">
                                <h3 id="relayName${i}" onclick="editName(${i})">${relay.name}</h3>
                                <input type="text" id="relayNameInput${i}" style="display:none" onblur="updateName(${i})">
                                <button onclick="toggleRelay(${i})" id="relay${i}Button" class="${relay.state ? 'on' : 'off'}">
                                    ${relay.state ? 'ON' : 'OFF'}
                                </button>
                                <br>
                                <label for="relayDelay${i}">Delay (ms):</label>
                                <input type="number" id="relayDelay${i}" value="${relay.delay}" onchange="updateDelay(${i})">
                            </div>`;
                        if (i === 4) {
                            controlsHtml += '</div><div class="relay-row">';
                        }
                    }
                    controlsHtml += '</div>';
                    document.getElementById('relayControls').innerHTML = controlsHtml;
                });
        }

        function toggleRelay(relayNum) {
            fetch(`/toggle_relay${relayNum}`)
                .then(() => updateRelayStates());
        }

        function editName(relayNum) {
            let nameElement = document.getElementById(`relayName${relayNum}`);
            let inputElement = document.getElementById(`relayNameInput${relayNum}`);
            nameElement.style.display = 'none';
            inputElement.style.display = 'inline';
            inputElement.value = nameElement.innerText;
            inputElement.focus();
        }

        function updateName(relayNum) {
            let nameElement = document.getElementById(`relayName${relayNum}`);
            let inputElement = document.getElementById(`relayNameInput${relayNum}`);
            let newName = inputElement.value;
            fetch(`/update_name${relayNum}?name=${encodeURIComponent(newName)}`)
                .then(() => {
                    nameElement.innerText = newName;
                    nameElement.style.display = 'block';
                    inputElement.style.display = 'none';
                });
        }

        function updateDelay(relayNum) {
            let delayElement = document.getElementById(`relayDelay${relayNum}`);
            let newDelay = delayElement.value;
            fetch(`/update_delay${relayNum}?delay=${newDelay}`);
        }

        createRelayControls();
        setInterval(updateRelayStates, 1000);
    </script>
</body>
</html>
